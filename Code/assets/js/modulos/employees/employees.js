import{msgError,msgSuccess}from"./../message.js";import{validatePasswordModerate}from"./../validation.js";if("?c=Empleados&m=showPerfil"==location.search){const e=()=>{fetch("?c=Empleados&m=show").then(e=>e.ok?Promise.resolve(e):Promise.reject(new Error("Error Show Empleado"))).then(e=>e.json()).then(e=>{r(e)})},r=e=>{document.getElementById("nombre_perfil").value=`${e.nombres}`,document.getElementById("apellidos_perfil").value=`${e.apellidos}`,document.getElementById("email_perfil").value=`${e.correo}`,document.getElementById("token_perfil").value=`${e.token}`,document.getElementById("img_perfil").src=`${e.img_usuario}`,document.getElementById("imgAvatarProfile").src=`${e.img_usuario}`},a=document.getElementById("change_img"),o=document.getElementById("img_perfil"),t=(e,r)=>{const a=e.files[0];if("image/jpeg"!=a.type&&"image/png"!=a.type&&"image/jpeg"!=a.type){return e.value="",msgError("la imagen debe ser png o jpeg"),r.src="",r.alt="image not found",!1}if(a.size>2e6){return e.value="",msgError("la imagen debe ser menor a 2mb"),r.src="",r.alt="image not found",!1}{r.src="";const e=new FileReader;return e.readAsDataURL(a),e.addEventListener("load",e=>{r.src=e.target.result}),!0}};a.addEventListener("change",()=>{t(a,o)});const s=(e,r)=>{if(""==e.value){e.focus(),msgError("Ingresar la contraseña")}else if(0==validatePasswordModerate(e.value)){e.focus(),msgError("Clave no valida Debe tener 1 letra minúscula, 1 letra mayúscula, 1 número y tener al menos 8 caracteres.")}else if(""==r.value){r.focus(),msgError("Ingresar la Confirmacion de contraseña")}else{if(r.value==e.value)return!0;r.focus(),msgError("Las contraseñas no coinciden ")}},n=(e,r)=>{if(""==e.value){e.focus(),msgError("Ingresar la contraseña Actual")}else if(""==r.value){r.focus(),msgError("Ingresar la Nueva de contraseña")}else{if(0!=validatePasswordModerate(r.value))return!0;r.focus(),msgError("Clave no valida Debe tener 1 letra minúscula, 1 letra mayúscula, 1 número y tener al menos 8 caracteres.")}},l=document.getElementById("updateProfile"),m=document.getElementById("btnupdatePassword"),i=()=>{const r=document.getElementById("token_perfil"),a=document.getElementById("validate_password"),o=document.getElementById("new_password");if(1==n(a,o)){const t=new FormData;t.append("token_perfil",r.value),t.append("validate_password",a.value),t.append("new_password",o.value),fetch("?c=Empleados&m=updatePass",{method:"POST",body:t}).then(e=>e.ok?Promise.resolve(e):Promise.reject(new Error("fallo actualizacion Contraseña"))).then(e=>e.json()).then(r=>{if("CI"==r.error){msgError("La Contraseña Actual es Incorrecta"),a.focus()}else if(r.error){msgError("Fallo la actualizacion del usuario")}else if("CA"==r.ok){$("#updatePassword").modal("hide"),msgSuccess("Contraseña Actualizada"),e(),a.value="",o.value=""}})}},d=()=>{const r=document.getElementById("token_perfil"),o=document.getElementById("password_perfil"),t=document.getElementById("confirm_password_perfil"),n=a.files[0];if(1==s(o,t)){const a=new FormData;a.append("token_perfil",r.value),a.append("password_perfil",o.value),a.append("confirm_password_perfil",t.value),a.append("change_img",n),fetch("?c=Empleados&m=update",{method:"POST",body:a}).then(e=>e.ok?Promise.resolve(e):Promise.reject(new Error("fallo actualizacion Profile"))).then(e=>e.json()).then(r=>{if(console.log(r),"CI"==r.error){msgError("Contraseña Incorrecta")}else if("IV"==r.error){msgError("Ingrese una imagen")}else if(r.error){msgError("Fallo la actualizacion del usuario")}else if(r.ok){msgSuccess("Imagen Actualizada"),e(),o.value="",t.value=""}})}};l.addEventListener("click",e=>{e.preventDefault(),d()}),m.addEventListener("click",e=>{e.preventDefault(),i()}),e()}